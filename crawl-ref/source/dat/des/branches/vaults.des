###############################################################################
# vaults.des: Entries to the Vaults branch, and Vaults:$ set-up.
#
# Vaults are scattered according to purpose across the rest of dat/des.
###############################################################################

{{
  -- Vaults:$ common loot substitutions
  function vaults_end_loot(e)
    e.subst("? = | * .:43")
    e.subst("| = | *:2")
    e.subst("* = * |:2")
  end

  -- Vaults:$ cross-vault rune substitution
  -- Turn 'O' into a rune (if it doesn't exist yet) or a good item
  --
  -- Note that this assumes that only one "prize" subvault is ever picked, and
  -- that it is the first subvault of the four.
  function vaults_end_rune(e)
    if dgn.map_by_tag("vaults_end_rune")
       and (e.has_tag("vaults_end_quadrant_prize")
              and crawl.one_chance_in(4)
            or e.has_tag("vaults_end_quadrant"))
    then
      e.subvault("O : vaults_end_rune")
    else
      e.subvault("O : vaults_end_norune")
    end
  end

  -- Find the slave of the teleporter and move to it.
  function teleporter_vault_action_fn(data, triggerable, triggerer, marker, ev)
    local position = dgn.point(marker:pos())
    my_slaves = dgn.find_marker_positions_by_prop("teleport_spot",
                                                  data.teleport_spot)

    if you.teleport_to(my_slaves[1].x, my_slaves[1].y, true) then
      crawl.mpr("Your surroundings suddenly seem different!")
    else
      crawl.mpr("There is a strange hissing noise.")
    end
  end

}}

###############################################################################
# Vaults entries
###############################################################################

############################################################
# Generic Vaults entry
#
NAME:    david_vaults_1
TAGS:    vaults_entry
MONS:    hill giant / troll / two-headed ogre
MONS:    necromancer / wizard / vampire w:4 / deep elf mage w:4
SHUFFLE: !-
SUBST:   ! = x, - = +, c : cxv
NSUBST:  1 = 1:1 / * = 1.., 2 = 1:2 / * = 2..
KFEAT:   O = enter_vaults
MAP
xxxxx.@.ccccc
x...+...c..2c
x...x...c...c
x!x-x.1.c...c
@.x.x12.+.O1c
x.x.x.1.c...c
x.x.x...c...c
x.+.x...c..2c
xxxxx.@.ccccc
ENDMAP

############################################################
# Vault monsters near stair
#
NAME: david_vaults_2
TAGS: vaults_entry
MONS: yaktaur captain, yaktaur, ogre mage, two-headed ogre
MONS: glowing shapeshifter, shapeshifter
SHUFFLE: 12 / 34 / 56
KFEAT:   O = enter_vaults
MAP
vvvvv.@....
v1.........
v..........
v.....2v.v.
@....2Ov..@
.....vvv.v.
...........
.....v.v.v.
......@....
ENDMAP

############################################################
# Vaults patterns 0: vanguard
#
NAME:    david_vaults_3
TAGS:    vaults_entry
MONS:    human
KMONS:   2 = orc knight / Donald, orc knight
KMONS:   3 = skeletal warrior w:20 / Norris, skeletal warrior
KMONS:   4 = hill giant / Rupert, hill giant
SHUFFLE: 2349
KFEAT:   O = enter_vaults
MAP
@..........@
....1131....
...1....1...
..1......1..
..2..O{..1..
..1..()..4..
..1......1..
...1....1...
....1911....
@..........@
ENDMAP

############################################################
# Vaults patterns I
#
NAME:    david_vaults_4
TAGS:    vaults_entry
MONS:    fire dragon / ice dragon / hydra / lindwurm
MONS:    freezing wraith / shadow wraith / wraith / phantasmal warrior
MONS:    deep troll / iron troll / troll
MONS:    two-headed ogre / cyclops / ettin / hill giant
MONS:    necromancer / glowing shapeshifter / vault guard / wizard
MONS:    shapeshifter
NSUBST:  1 = 1:1 / 1:2 / 1:3. / 1 : 4 .:30 / 1:5 .:70
SHUFFLE: 12345
SUBST:   * = *.%, c : cvv, 6 = 6...
KFEAT:   O = enter_vaults
MAP
@..........@
.cccccccccc.
.c.11111..c.
.c.ccccc..c.
.c.c***c..c.
.c.+**Oc..c.
.ccccccc..c.
...666....c.
.cc...ccccc.
@..........@
ENDMAP

############################################################
# Vaults patterns II
#
NAME:   david_vaults_5
TAGS:   vaults_entry
KMONS:  O = vault guard
KFEAT:  O = enter_vaults
SUBST:  ! : !., ? : ?.
SUBST:  ?! = .:30 0:10 9:5 %:10 *:5
MAP
xxxxxxxxxxxxxx
xOx!x!x?x!x?xx
xx!x?x!x!x?x!x
x!x!x!x?x!x?xx
xx?x!x?x?x?x!x
x!x?x.x.x.x.xx
xx?x?x.x.x.x.x
x?x?x!x?x.x.xx
xx!x!x!x?x.x.x
xxxxxxxxxxxxx@
ENDMAP

############################################################
# The Guard of Blades
#
NAME:   erik_vaults_1
TAGS:   vaults_entry
MONS:   dancing weapon ; long sword good_item
SUBST:  v : vcxxx
KFEAT:  O = enter_vaults
MAP
.............
.............
.....v%v.....
....vvvvv....
.....1O1.....
....vvvvv....
.....v%v.....
.............
.............
ENDMAP

############################################################
# Above As Below
#
NAME:    erik_vaults_2
TAGS:    vaults_entry
MONS:    vault guard
SUBST:   v : vxx, b : bcc
KFEAT:   O = enter_vaults
MAP
vvvvvv.vvvvvv
vvvvvv.vvvvvv
vvvvbb.bbvvvv
vvvvb111bvvvv
.....1O1.....
vvvvb111bvvvv
vvvvbb.bbvvvv
vvvvvv.vvvvvv
vvvvvv.vvvvvv
ENDMAP

############################################################
# HangedMan's map
#
NAME:    hangedman_vaults_entry_quadrant_bands
TAGS:    vaults_entry no_monster_gen no_item_gen patrolling
ORIENT:  float
MONS:    centaur warrior, centaur / nothing w:5
MONS:    ogre mage, two-headed ogre / ogre w:16
MONS:    orc knight, orc priest / orc warrior / orc wizard / orc w:15
KMONS:   7 = yaktaur
KMONS:   8 = yaktaur / nothing w:5
KMONS:   9 = deep elf knight
KMONS:   0 = deep elf mage / deep elf priest / deep elf fighter / nothing w:15
KMONS:   A = boggart / kobold demonologist
KMONS:   B = big kobold / kobold w:5
KMONS:   C = skeletal warrior
KMONS:   D = skeleton
KMASK:   @` = !no_item_gen
KFEAT:   O = enter_vaults
SHUFFLE: 12 / 34 / 56 / 78 / 90 / AB / CD, O%*|
SUBST:   $ = $$., * = **%, | = **|., ` = .
MAP
vvvvvvv@@vvvvvvv
vO2...v``v...4*v
v2$v2vv``vv4v$4v
v.v1v.v``v.v3v.v
v.2vv.v``v.vv4.v
v.v....``....v.v
vvvvv.v``v.vvvvv
@``````````````@
@``````````````@
vvvvv.v``v.vvvvv
v.v....``....v.v
v.6vv.v``v.vv8.v
v.v5v.v``v.v7v.v
v6$v6vv``vv8v$8v
v%6...v``v...8|v
vvvvvvv@@vvvvvvv
ENDMAP

############################################################
# Tiered entry
#
NAME:   grunt_vaults_entry_tiered
TAGS:   vaults_entry no_monster_gen no_rtele_into transparent
MONS:   human w:29 / orc warrior w:1
MONS:   necromancer / wizard / yaktaur w:2
MONS:   vault guard w:29 / deep elf knight w:1
SUBST:  x : xcv
NSUBST: 2 = 1:2 / * = 12, 3 = 1:3 / * = 113
KFEAT:  O = enter_vaults
MAP
...............
.xxxxxxxxxxxxx.
.x%%...x...%%x.
.x%212.+.323%x.
.x.1T1.+..O2.x.
.x.1.1.+.323%x.
.x.....x...%%x.
.xx+++xxxxxxxx.
.x.....x...%%x.
.x.111.+....%x.
.x.2T..+.1T1.x.
.x%111.+.1.1.x.
.x%%...x.....x.
.xxxxxxxx+++xx.
.........@@@...
ENDMAP

############################################################
# A fortification!
#
NAME: grunt_vaults_entry_fortified
TAGS: vaults_entry no_pool_fixup no_monster_gen patrolling
ORIENT: north
MONS: human ; arbalest . bolt q:10 . short sword | dagger . \
              leather armour w:5 | ring mail | scale mail / \
      orc warrior ; arbalest . bolt q:10 . short sword | dagger . \
                    leather armour w:5 | ring mail | scale mail / \
      deep elf fighter / gargoyle / yaktaur
MONS: vault guard / orc knight w:2
MONS: wizard / tengu conjurer / orc sorcerer / ogre mage
NSUBST: T = 1:U / *:T
KFEAT: O = enter_vaults
MAP
xxxxxxxxxxxxxxxxxxx
xxxxxxxvvvvvxxxxxxx
xxxxxxxvT.Tvxxxxxxx
xxxxxxxv2O2vxxxxxxx
xxxxxxxvT.Tvxxxxxxx
xvvvvvvvv+vvvvvvvvx
xv*...3.....3...*vx
xv.......2.......vx
xv...............vx
xvv+vvvv.v.vvvv+vvx
xv...vxv...vxv...vx
xv...vxv.1.vxv...vx
xv...vxv...vxv...vx
xvv12vvv+++vvv21vvx
.wwwwwwW...Wwwwwww.
.WwwwwwW...WwwwwwW.
 .WwwwWW...WwwwwW.
  .WWWW.....WWWW.
   ......@......
ENDMAP

############################################################

NAME: lightli_vaults_fourway_checkpoint
TAGS: vaults_entry transparent
MONS: vault guard
KFEAT: O = enter_vaults
MAP
.................
...vv.......vv...
..vvvv.....vvvv..
.vvvvvv...vvvvvv.
.vvvvvvv+vvvvvvv.
..vvvv.....vvvv..
...vv.v0.0v.vv...
....v.0.1.0.v....
....+..1O1..+....
....v.0.1.0.v....
...vv.v0.0v.vv...
..vvvv.....vvvv..
.vvvvvvv+vvvvvvv.
.vvvvvv...vvvvvv.
..vvvv.....vvvv..
...vv.......vv...
.................
ENDMAP

###############################################################################
# Vaults:$ last level of the vaults -- dungeon.cc will change all these 'x's
###############################################################################
#
# This map traditionally allows controlled teleports. Even with the now
# random placement of the rune, this seems fine: some of the spots are
# awkward to reach via teleport, and there is now always a monster on the
# rune.
#
# Vaults:$ extensively uses subvaults. To provide another Vaults:$ quadrant
# variation, create a map tagged vaults_end_quadrant that is 27x23. It should
# have three blank cells on one corner (see any existing quadrant for an
# example), which will be used to orient that corner towards the middle of
# the map. Each quadrant must be capable of generating a rune, which
# should be done by placing an 'O' glyph and calling vaults_end_rune(_G).
#
# There is a lot of variance among the possible quadrants but we do ensure
# that (exactly) one quadrant with rich loot is generated. Those are tagged
# vaults_end_quadrant_prize and come in their own section below.

#############################################################
# The main vault for Vaults:$.
#
NAME:     vaults_vault
PLACE:    Vaults:$
ORIENT:   encompass
TAGS:     no_rotate no_dump
SHUFFLE:  ABCD
: if crawl.one_chance_in(36) then
SUBVAULT: A : vaults_end_quadrant_prize_mall
SUBVAULT: B : vaults_end_quadrant_mall
SUBVAULT: C : vaults_end_quadrant_mall
SUBVAULT: D : vaults_end_quadrant_mall
: else
SUBVAULT: A : vaults_end_quadrant_prize
SUBVAULT: B : vaults_end_quadrant
SUBVAULT: C : vaults_end_quadrant
SUBVAULT: D : vaults_end_quadrant
:end
SUBST:    ABCD = .
MONS: vault guard
{{
  set_feature_name("metal_wall", "heavily etched metal wall")
  set_feature_name("green_crystal_wall", "heavily etched wall of green crystal")
}}
MAP
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xx9..............................0.............................9xx
xx..............................................................xx
xx....AAAAAAAAAAAAAAAAAAAAAAA........BBBBBBBBBBBBBBBBBBBBBBB....xx
xx...AAAAAAAAAAAAAAAAAAAAAAAAA......BBBBBBBBBBBBBBBBBBBBBBBBB...xx
xx..AAAAAAAAAAAAAAAAAAAAAAAAAAA....BBBBBBBBBBBBBBBBBBBBBBBBBBB..xx
xx..AAAAAAAAAAAAAAAAAAAAAAAAAAA....BBBBBBBBBBBBBBBBBBBBBBBBBBB..xx
xx..AAAAAAAAAAAAAAAAAAAAAAAAAAA....BBBBBBBBBBBBBBBBBBBBBBBBBBB..xx
xx..AAAAAAAAAAAAAAAAAAAAAAAAAAA....BBBBBBBBBBBBBBBBBBBBBBBBBBB..xx
xx..AAAAAAAAAAAAAAAAAAAAAAAAAAA....BBBBBBBBBBBBBBBBBBBBBBBBBBB..xx
xx..AAAAAAAAAAAAAAAAAAAAAAAAAAA....BBBBBBBBBBBBBBBBBBBBBBBBBBB..xx
xx..AAAAAAAAAAAAAAAAAAAAAAAAAAA....BBBBBBBBBBBBBBBBBBBBBBBBBBB..xx
xx..AAAAAAAAAAAAAAAAAAAAAAAAAAA....BBBBBBBBBBBBBBBBBBBBBBBBBBB..xx
xx..AAAAAAAAAAAAAAAAAAAAAAAAAAA....BBBBBBBBBBBBBBBBBBBBBBBBBBB..xx
xx..AAAAAAAAAAAAAAAAAAAAAAAAAAA....BBBBBBBBBBBBBBBBBBBBBBBBBBB..xx
xx..AAAAAAAAAAAAAAAAAAAAAAAAAAA....BBBBBBBBBBBBBBBBBBBBBBBBBBB..xx
xx..AAAAAAAAAAAAAAAAAAAAAAAAAAA....BBBBBBBBBBBBBBBBBBBBBBBBBBB..xx
xx..AAAAAAAAAAAAAAAAAAAAAAAAAAA....BBBBBBBBBBBBBBBBBBBBBBBBBBB..xx
xx..AAAAAAAAAAAAAAAAAAAAAAAAAAA....BBBBBBBBBBBBBBBBBBBBBBBBBBB..xx
xx..AAAAAAAAAAAAAAAAAAAAAAAAAAA....BBBBBBBBBBBBBBBBBBBBBBBBBBB..xx
xx..AAAAAAAAAAAAAAAAAAAAAAAAAAA....BBBBBBBBBBBBBBBBBBBBBBBBBBB..xx
xx..AAAAAAAAAAAAAAAAAAAAAAAAAAA....BBBBBBBBBBBBBBBBBBBBBBBBBBB..xx
xx..AAAAAAAAAAAAAAAAAAAAAAAAAAA....BBBBBBBBBBBBBBBBBBBBBBBBBBB..xx
xx..AAAAAAAAAAAAAAAAAAAAAAAAAAA.11.BBBBBBBBBBBBBBBBBBBBBBBBBBB..xx
xx...AAAAAAAAAAAAAAAAAAAAAAAA..1111..BBBBBBBBBBBBBBBBBBBBBBBB...xx
xx....AAAAAAAAAAAAAAAAAAAAAAA.1....1.BBBBBBBBBBBBBBBBBBBBBBB....xx
xx...........................1..(<..1...........................xx
xx0.........................11.[..{.11..........................xx
xx...........................1..<<..1..........................0xx
xx............................1....1............................xx
xx....CCCCCCCCCCCCCCCCCCCCCCC..1111..DDDDDDDDDDDDDDDDDDDDDDD....xx
xx...CCCCCCCCCCCCCCCCCCCCCCCC...11...DDDDDDDDDDDDDDDDDDDDDDDD...xx
xx..CCCCCCCCCCCCCCCCCCCCCCCCCCC....DDDDDDDDDDDDDDDDDDDDDDDDDDD..xx
xx..CCCCCCCCCCCCCCCCCCCCCCCCCCC....DDDDDDDDDDDDDDDDDDDDDDDDDDD..xx
xx..CCCCCCCCCCCCCCCCCCCCCCCCCCC....DDDDDDDDDDDDDDDDDDDDDDDDDDD..xx
xx..CCCCCCCCCCCCCCCCCCCCCCCCCCC....DDDDDDDDDDDDDDDDDDDDDDDDDDD..xx
xx..CCCCCCCCCCCCCCCCCCCCCCCCCCC....DDDDDDDDDDDDDDDDDDDDDDDDDDD..xx
xx..CCCCCCCCCCCCCCCCCCCCCCCCCCC....DDDDDDDDDDDDDDDDDDDDDDDDDDD..xx
xx..CCCCCCCCCCCCCCCCCCCCCCCCCCC....DDDDDDDDDDDDDDDDDDDDDDDDDDD..xx
xx..CCCCCCCCCCCCCCCCCCCCCCCCCCC....DDDDDDDDDDDDDDDDDDDDDDDDDDD..xx
xx..CCCCCCCCCCCCCCCCCCCCCCCCCCC....DDDDDDDDDDDDDDDDDDDDDDDDDDD..xx
xx..CCCCCCCCCCCCCCCCCCCCCCCCCCC....DDDDDDDDDDDDDDDDDDDDDDDDDDD..xx
xx..CCCCCCCCCCCCCCCCCCCCCCCCCCC....DDDDDDDDDDDDDDDDDDDDDDDDDDD..xx
xx..CCCCCCCCCCCCCCCCCCCCCCCCCCC....DDDDDDDDDDDDDDDDDDDDDDDDDDD..xx
xx..CCCCCCCCCCCCCCCCCCCCCCCCCCC....DDDDDDDDDDDDDDDDDDDDDDDDDDD..xx
xx..CCCCCCCCCCCCCCCCCCCCCCCCCCC....DDDDDDDDDDDDDDDDDDDDDDDDDDD..xx
xx..CCCCCCCCCCCCCCCCCCCCCCCCCCC....DDDDDDDDDDDDDDDDDDDDDDDDDDD..xx
xx..CCCCCCCCCCCCCCCCCCCCCCCCCCC....DDDDDDDDDDDDDDDDDDDDDDDDDDD..xx
xx..CCCCCCCCCCCCCCCCCCCCCCCCCCC....DDDDDDDDDDDDDDDDDDDDDDDDDDD..xx
xx..CCCCCCCCCCCCCCCCCCCCCCCCCCC....DDDDDDDDDDDDDDDDDDDDDDDDDDD..xx
xx..CCCCCCCCCCCCCCCCCCCCCCCCCCC....DDDDDDDDDDDDDDDDDDDDDDDDDDD..xx
xx...CCCCCCCCCCCCCCCCCCCCCCCCC......DDDDDDDDDDDDDDDDDDDDDDDDD...xx
xx....CCCCCCCCCCCCCCCCCCCCCCC........DDDDDDDDDDDDDDDDDDDDDDD....xx
xx..............................................................xx
xx9.............................0..............................9xx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# Vaults:$ - the subvault used to place the rune.
#
# Used by the 'vaults_end_rune()' function in the prelude.
#
NAME:  vaults_end_rune
TAGS:  vaults_end_rune
KMONS: O = 8 / 9
KITEM: O = silver rune of Zot
MAP
O
ENDMAP

############################################################
# Vaults:$ - the subvault used for potential rune locations that do not
# contain the real rune.
#
# Used by the 'vaults_end_rune()' function in the prelude.
#
NAME:  vaults_end_norune
TAGS:  vaults_end_norune allow_dup unrand
KMONS: o = 8 / 9
: if crawl.random2(13) == 12 then
KFEAT:   o = any shop
: else
KITEM:   o = any good_item
: end
MAP
o
ENDMAP

############################################################
# Vaults:$ - the subvault used for potential rune locations that do not
# contain the rune, but rather a mimic of it!
#
# Used by the 'vaults_end_rune()' function in the prelude.
#
NAME:    vaults_end_rune_mimic
TAGS:    vaults_end_norune unrand
WEIGHT:  1
KITEM:   o = silver rune of Zot mimic
MAP
o
ENDMAP

###############################################################################
# Vaults:$ quadrants
###############################################################################

############################################################
# about 2 |
NAME: vaults_end_classical_cross
TAGS: vaults_end_quadrant unrand
NSUBST:  U = 1:. / *:xxxx.
NSUBST:  V = 1:. / *:xxxx.
SUBST:   - = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  ..xxxxxxxxxxxxxxxxxxx..
 ...xxxxxxxxxxxxxxxxxxx..
....xx...............xx....
xxx.......-.....-.......xxx
xxx...-.............-...xxx
xx.......................xx
xx.-....xxxxxxxxxxx....-.xx
xx......x.........x......xx
xx....xxU.........Uxx....xx
xx..-.x....xxxxx....x....xx
xx....x.-.Vx$$$xx...x.-..xx
xx....x..xx$***$xx..x....xx
xx.-..x..x$$*O*$$x-.x....xx
xx....x..xx$***$xx..x....xx
xx....x...Vx$$$xV...x..-.xx
xx..-.xxx-.xxxxx..Uxx....xx
xx......x.........x......xx
xx......xxxxxxxxxxx.-....xx
xxx...-.................xxx
xxx........-....-.......xxx
....xx...............xx....
 ...xxxxxxxxxxxxxxxxxxx...
  ..xxxxxxxxxxxxxxxxxxx..
ENDMAP

############################################################
# about 4 |
NAME:    vaults_end_classical_diamond
TAGS:    vaults_end_quadrant unrand
SHUFFLE: !_
SUBST:   ! = | * .:20
SUBST:   _ = 8 9 .:20
SUBST:   a : x .
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  a.xxxxxxxxxxxxxxxxxxx.a
 a!x.x.x!x.x.x.x.x.x.x.x.
a.x.x.x.x.x.x.x!x.x.x_x.x.a
.x.x!x.x.x.x.x.x.x.x!x.x.x.
x.x.x.x.x_x.x.x_x.x.x.x.x.x
xx.x.x.x.x.x.x.x.x.x.x.x_xx
x.x.x!x.x.x.x.x.x.x!x.x.x.x
xx.x_x.x.x!x.x.x.x.x.x.x.xx
x.x.x.x.x_x.x.x.x.x.x.x.x.x
xx.x.x.x.x.x.x.x.x.x.x.x!xx
x_x.x!x.x.x.x.x.x!x.x_x.x.x
xx.x.x.x.x.x.O.x.x.x.x.x.xx
x.x.x_x.x.x.x.x.x.x.x.x_x.x
xx.x.x.x.x.x.x_x.x.x.x.x.xx
x!x.x.x.x!x.x.x.x.x.x.x.x.x
xx.x.x.x.x.x.x!x.x.x.x.x.xx
x.x.x.x.x.x.x.x.x.x_x.x.x.x
xx.x_x.x.x.x.x.x.x.x.x.x_xx
x.x!x.x.x.x.x.x.x!x.x.x.x.x
.x.x.x.x.x.x.x_x.x.x.x.x.x.
a.x.x.x.x.x_x.x.x.x.x.x.x.a
 a.x.x_x.x.x!x.x.x.x.x!x_a
  a.xxxxxxxxxxxxxxxxxxx.a
ENDMAP

############################################################
# about 5 |
NAME: vaults_end_classical_stripes
TAGS: vaults_end_quadrant unrand
# double use of Y=Y. and Z=Z. for decreasing variance
SUBST:   Y = Y ., Z = Z ., Y = Y ., Z = Z .
SUBST:   Y = 9:30 8:10 .:40
SUBST:   Z = 9:10 8:30 .:40
SUBST:   a : x ., b : x ., c : x .
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  axaxxaaxaxxxxxxxxxxxxbx
  ........................
a................Y..Z.....x
x..Y..Y..Y..Y..Y..Z..Y..Y.b
a...Y..Y..Y..Z..Y..Y..Z...x
x.Y..Y..Y..Y..Z..Y..Z..Y..x
x..Y..Y..Z..Z..Y..Y..Y..Z.x
a...Y..Z..Y..Y..Z..Y..Y...x
a.Y..Y..Z..Z??Y..Y..Y..Z..x
x..Z..Y..Y??Y??Z..Y..Y..Y.x
x...Y..Y??Z??Y??Z..Z..Y...x
x.Z..Z..Y??YO?Z??Y..Z..Z..x
x..Y..Z..Y??Z??Z?.Y..Z..Z.x
x...Z..Z..Z??Y?.Z..Z..Y...x
x.Y..Z..Y..Z?.Z..Z..Z..Z..x
x..Z..Y..Z..Y..Z..Z..Z..Z.x
x...Y..Z..Z..Z..Z..Z..Z...x
x....Z..Y..Z..Y..Z..Z..Z..x
x..Z..Z..Y..Z..Z..........x
b...Z..Y..Z..Z............c
x....Y..Z..Z..Z..Z........x
 .........................
  xbxxxxxxxxxxxxxxxxxxxcx
ENDMAP

############################################################
# about 4 |
NAME:   vaults_end_mu_clover
TAGS:   vaults_end_quadrant unrand
SUBST:  9 = 8 9 .:20
NSUBST: ? = 1:O / *:*
NSUBST: " = 1:. / *:x
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 ........................
x.........................x
x..xxxxxxxxx999xxxxxxxxx..x
x..x?**....x...x....**?x..x
x..x**..9..x...x..9..**x..x
x..x*..9...x...x...9..*x..x
x..x..9....xx"xx....9..x..x
x..x...................x..x
x..xxxxxxxx.....xxxxxxxx..x
x..9......x.....x......9..x
x..9......"....."......9..x
x..9......x.....x......9..x
x..xxxxxxxx.....xxxxxxxx..x
x..x...................x..x
x..x..9....xx"xx....9..x..x
x..x*..9...x...x...9..*x..x
x..x**..9..x...x..9..**x..x
x..x?**....x...x....**?x..x
x..xxxxxxxxx999xxxxxxxxx..x
x.........................x
 .........................
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# about 8 |
NAME:   vaults_end_mu_not_diamond
TAGS:   vaults_end_quadrant unrand
SUBST:  9 = 8 9 *:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 ..x9x.x.x.x.x.x.x.x.x.x.
x.x.x.x.x.x.x.x.x.x.x.x9x.x
xx.x.x.x.x9x.x.x9x.x.x.x.xx
x.x.xxxxxxxxx.xxxxxxxxx.x.x
xx9xxxxxxxxx.x.xxxxxxxxx.xx
x.x.xxxxxxxx...xxxxxxxx.x.x
xx.xxxxxxx...9...xxxxxxx9xx
x.x.xxxxx.........xxxxx.x.x
xx.xxxxx...|$|$|...xxxxx.xx
x9x.x.x....$***$....x.x.x.x
xx.x.x.x.9.|*O*|.9.x.x.x.xx
x.x.x.x....$***$....x.x.x9x
xx.xxxxx...|$|$|...xxxxx.xx
x.x.xxxxx.........xxxxx.x.x
xx.xxxxxxx...9...xxxxxxx.xx
x.x.xxxxxxxx...xxxxxxxx.x.x
xx9xxxxxxxxx.x.xxxxxxxxx9xx
x.x.xxxxxxxxx.xxxxxxxxx.x.x
xx.x.x.x.x9x.x.x9x.x.x.x.xx
x.x.x.x.x.x.x.x.x.x.x.x.x.x
 ..x9x.x.x.x.x.x.x.x.x9x..
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# about 11 |
NAME:    vaults_end_mu_boxes
TAGS:    vaults_end_quadrant unrand
NSUBST:  a = 1:+ / *:x
NSUBST:  b = 1:+ / *:x
NSUBST:  c = 1:+ / *:x
NSUBST:  d = 1:+ / *:x
NSUBST:  e = 1:+ / *:x
NSUBST:  f = 1:+ / *:x
NSUBST:  g = 1:+ / *:x
SHUFFLE: ABCDEFG
SUBST:   ABC = 9
SUBST:   D = |*$9
SUBST:   E = |
SUBST:   F = *
NSUBST:  G = 1:O / *:9
SUBST:   9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 ........................
x..........xxbxx..........x
x..........xBBBx..........x
x..xxaxx...bBBBb...xxcxx..x
x..xAAAx...xBBBx...xCCCx..x
x..aAAAa...xxbxx...cCCCc..x
x..xAAAx...........xCCCx..x
x..xxaxx...........xxcxx..x
x..........xxdxx..........x
x..........xDDDx..........x
x....9.....dDDDd.....9....x
x..........xDDDx..........x
x..........xxdxx..........x
x..xxfxx...........xxgxx..x
x..xFFFx...........xGGGx..x
x..fFFFf...xxexx...gGGGg..x
x..xFFFx...xEEEx...xGGGx..x
x..xxfxx...eEEEe...xxgxx..x
x..........xEEEx..........x
x..........xxexx..........x
 .........................
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# about 8 |
NAME:   vaults_end_mu_long
TAGS:   vaults_end_quadrant unrand
SUBST:  9 = 8 9 .:10
NSUBST: $ = 1:O / *:$
SUBST:  $ = |**$
SUBST:  a = x.
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  axxxxxxxxxxxxxxxxxxxxxa
 ........................
a.........................a
x.........................x
x..xxxxxxxxxxxxxxxxxxxxx..x
x....999............$$$x..x
x....999............$$$x..x
x..xxxxxxxxxxxxxxxxxxxxx..x
x..x$$$............999....x
x..x$$$............999....x
x..xxxxxxxxxxxxxxxxxxxxx..x
x....999............$$$x..x
x....999............$$$x..x
x..xxxxxxxxxxxxxxxxxxxxx..x
x..x$$$............999....x
x..x$$$............999....x
x..xxxxxxxxxxxxxxxxxxxxx..x
x....999............$$$x..x
x....999............$$$x..x
x..xxxxxxxxxxxxxxxxxxxxx..x
a.........................a
  .......................
  axxxxxxxxxxxxxxxxxxxxxa
ENDMAP

############################################################
# 19 *, 14 monsters
NAME:   vaults_end_minmay_circular_pillars
TAGS:   vaults_end_quadrant unrand
NSUBST: a = 1:+ / *:x, b = 1:+ / *:x, c = 1:+ / *:x, d = 1:+ / *:x
NSUBST: O = 1:O / *:*
SUBST:  9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 ..9..9xxxx9...9xxxx9....
x.......xx.......xx.......x
x9..xx......xbx......xx...x
x..xxxx....xx*xx....xxxx..x
x..xxxx....b*O*b....xxxx..x
x9..xx9....xx*xx....9xx..9x
xx..........xbx..........xx
xxx.....................xxx
xxx..xax...9...9...xcx..xxx
xx..xx*xx.........xx*xx..xx
x9..a*O*a.........c*O*c..9x
xx..xx*xx.........xx*xx..xx
xxx..xax...9...9...xcx..xxx
xxx.....................xxx
xx..........xdx..........xx
x9..xx9....xx*xx....9xx..9x
x..xxxx....d*O*d....xxxx..x
x..xxxx....xx*xx....xxxx..x
x9..xx......xdx......xx..9x
x.......xx.......xx.......x
 ..9..9xxxx9...9xxxx9..9..
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 20 *, 12 monsters
NAME:   vaults_end_minmay_hexagonal
TAGS:   vaults_end_quadrant unrand
SUBST:  9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 ....xx9...........9xx...
x.........................x
x..xx...xxxxx.xxxxx.......x
x..x...xx9.......9xx......x
x..x..xx...........xx.....x
xx....x...xxx.xxx...x....xx
xx...xx..xx9...9xx..xx...xx
xx..xx...x.......x...xx..xx
x9..x9..xx..***..xx..9x..9x
x..xx..xx9.*****.9xx..xx..x
x..........**O**..........x
x..xx..xx9.*****.9xx..xx..x
x9..x9..xx..***..xx..9x..9x
xx..xx...x.......x...xx..xx
xx...xx..xx9...9xx..xx...xx
xx....x...xxx.xxx...x....xx
x..x..xx...........xx..x..x
x..x...xx9.......9xx...x..x
x..xx...xxxxx.xxxxx...xx..x
x.........................x
 ....xx9...........9xx....
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 16 *, 10 monsters
NAME:  vaults_end_minmay_subdivision
TAGS:  vaults_end_quadrant unrand
SUBST: 9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 .....x....*xxx*....x....
x.....x.....xxx.....x.....x
x.....x.....xxx.....x.....x
x....9x9....xxx....9x9....x
xxxxxx.xxxxx...xxxxx.xxxxxx
x....9x9....xxx....9x9....x
x.....x.....xxx.....x.....x
x.....x.....xxx.....x.....x
x*....x....*xxx*....x....*x
xxxxxx.xxxxx9*9xxxxx.xxxxxx
xxxxxx.xxxxx*O*xxxxx.xxxxxx
xxxxxx.xxxxx9*9xxxxx.xxxxxx
x*....x....*xxx*....x....*x
x.....x.....xxx.....x.....x
x.....x.....xxx.....x.....x
x....9x9....xxx....9x9....x
xxxxxx.xxxxx...xxxxx.xxxxxx
x....9x9....xxx....9x9....x
x.....x.....xxx.....x.....x
x.....x.....xxx.....x.....x
 .....x....*xxx*....x.....
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 14 *, 8 monsters
NAME:   vaults_end_minmay_triangle_fans
TAGS:   vaults_end_quadrant unrand
SUBST:  9 = 8 9 .:20
NSUBST: O = 1:O / *:*
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  ...xxxxxxxxxxxxxxxxxxxx
 xxxx.....9xxxx.....9xxxx
.xxx..x....xxx..x....xxx..x
.xx...xx...xx...xx...xx...x
.x....xxx..x....xxx..x....x
x....9xxxx.....9xxxx......x
x.xxxx9.....xxxx9.....xxxxx
x..xxx...*x.*xxx...*x..xxxx
x...xx...xx..Oxx...xx...xxx
x....x.*xxx...*x.*xxx....xx
x......xxxx9.....xxxx9....x
x.........................x
xxxxx.....9xxxx.....9xxxx.x
xxxx..x*...xxx*.x*...xxx..x
xxx...xx...xxO..xx...xx...x
xx....xxx*.x*...xxx*.x....x
x....9xxxx.....9xxxx......x
x.xxxx9.....xxxx9.....xxxxx
x..xxx....x..xxx....x..xxxx
x...xx...xx...xx...xx...xxx
x....x..xxx....x..xxx....xx
 ......xxxx9.....xxxx9....
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 8 |, 11 monsters
NAME:   vaults_end_minmay_pillar_box
TAGS:   vaults_end_quadrant unrand
SUBST:  9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 ........................
x.x.x.x.x.x.x.x.x.x.x.x.x.x
x.........................x
x.x.xx9xx..xx9xx..xx9xx.x.x
x...xx.xx..xx.xx..xx.xx...x
x.x.9.|....9.|.9....|.9.x.x
x...xx.xx..xx.xx..xx.xx...x
x.x.xx.xx..xx.xx..xx.xx.x.x
x...9...9..xx.xx..9...9...x
x.x.xx.xx..x...x..xx.xx.x.x
x...xx|xx..x.O.x..xx|xx...x
x.x.xx.xx..x...x..xx.xx.x.x
x...9...9..xx.xx..9...9...x
x.x.xx.xx..xx.xx..xx.xx.x.x
x...xx.xx..xx.xx..xx.xx...x
x.x.9.|....9.|.9....|.9.x.x
x...xx.xx..xx.xx..xx.xx...x
x.x.xx9xx..xx9xx..xx9xx.x.x
x.........................x
x.x.x.x.x.x.x.x.x.x.x.x.x.x
 .........................
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 20 *, 15 monsters
NAME:   vaults_end_minmay_partial_spiral
TAGS:   vaults_end_quadrant unrand
SUBST:  9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 .........................
x.........................x
x..x99xxxxxxxxxxxxxxxxxx..x
x..x................9..9..x
x..x................9..9..x
x..x99x99xxxxxxxxxxxx..x..x
x..x..x..........9..9..x..x
x..x..x..........9..9..x..x
x..x..x99xxxxxxxxx..x..x..x
x..x..x..x*******x..x..x..x
x..x..x..+***O***x..x..x..x
x..x..x..x*******x..x..x..x
x..x..xxxxxxxxxxxx99x..x..x
x..9..9.............x..x..x
x..9..9.............x..x..x
x..xxxxxxxxxxxxxxx99x99x..x
x..9...................x..x
x..9...................x..x
x..xxxxxxxxxxxxxxxxxx99x..x
x.........................x
 ........................
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 2 |, 19 *, 16 monsters
NAME:   vaults_end_minmay_grid2
TAGS:   vaults_end_quadrant unrand
SUBST:  9 = 8 9 .:20
NSUBST: O = 1:O / 1:* / *:|
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  .xxxxxxxxxxxxxxxxxxxxxx
 ..xx**xx**xx**xx**xx**xx.
xxx..xx..xx..xx..xx..xx..xx
xxx.9xx9.xx..xx..xx.9xx9.xx
x..xx..xx..xx..xx..xx..xx*x
x..xx..xx..xx..xx..xx..xx*x
xxx.9xx9.xx..xx..xx.9xx9.xx
xxx..xx.9xx9.xx.9xx9.xx..xx
x..xx..xx..xx..xx..xx..xx*x
x..xx..xx..xx..xx..xx..xx*x
xxx..xx.9xx9OxxO9xx9.xx..xx
xxx..xx.9xx9OxxO9xx9.xx..xx
x..xx..xx..xx..xx..xx..xx*x
x..xx..xx..xx..xx..xx..xx*x
xxx..xx.9xx9.xx.9xx9.xx..xx
xxx.9xx9.xx..xx..xx.9xx9.xx
x..xx..xx..xx..xx..xx..xx*x
x..xx..xx..xx..xx..xx..xx*x
xxx.9xx9.xx..xx..xx.9xx9.xx
xxx..xx..xx..xx..xx..xx..xx
x..xx..xx..xx..xx..xx..xx..
  .xx..xx..xx..xx..xx..xx.
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 2 |, 15 *, 14 monsters
NAME:   vaults_end_minmay_pluses
TAGS:   vaults_end_quadrant unrand
SUBST:  9 = 8 9 .:20
NSUBST: O = 1:O / *:|
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 .....x......x......x....
x.........................x
x.........................x
x.....x......x......x.....x
xx...xxx9999xxx9999xxx...xx
x.....x......x......x.....x
x.....9......x......9.....x
x.....9.....*x......9.....x
x.....9....**x......9.....x
x.....x...**Ox......x.....x
xx...xxxxxxxxxxxxxxxxx...xx
x.....x...**OxO**...x.....x
x.....9....**x**....9.....x
x.....9.....*x*.....9.....x
x.....9......x......9.....x
x.....x......x......x.....x
xx...xxx9999xxx9999xxx...xx
x.....x......x......x.....x
x.........................x
x.........................x
 .....x......x......x.....
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 14 *, 9 monsters
NAME:   vaults_end_minmay_broken_diamonds
TAGS:   vaults_end_quadrant unrand
SUBST:  9 = 8 9 .:20
NSUBST: * = 1:O / 14:* / *:.
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 ..xx....9xx...xx9....xx..
x........xx.....xx........x
xx......xx...x...xx......xx
xxx....xx....xx...xx....xxx
x9xx...x......xx...x...xx9x
x..xx........**xx.....xx..x
x...xx...xx.***9xx........x
x.........xx**9xx...x....xx
x......x...xx9xx...xxx...xx
xx....xxx...xxx...xx9xx...x
xx...xx9xx...x...xx9**xx..x
x...xx**9xx.......xx**....x
x..xx.***9xx...x...xx....xx
x9.....**xx....xx...x...xxx
xx......xx....**xx.....xx9x
xxx....xx...xx**9xx...xx..x
x.xx...x.....xx9xx........x
x..xx.....x...xxx...x....xx
x...xx...xx....x....xx...xx
x.......xx...........xx...x
 ......xx9..xx...xx..9xx..
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 17 *, 10 monsters
NAME:   vaults_end_minmay_smooth_crossroads
TAGS:   vaults_end_quadrant unrand
SUBST:  9 = 8 9 .:20
NSUBST: O = 1:O / *:.
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 9.....x9.....9x9........
x......x.......x...x....9.x
x.....xx...x...x...xx.....x
x.....x....x...x....x.....x
x....xx....x...x....xx....x
x..xxx....xx...xx....xxx..x
x.xx......x*...*x......xxxx
x........xx*...*xx.......9x
x9.....xxxO.....Oxxx......x
xxxxxxxx**...9...**xxxx...x
x9..........9x9..........9x
x...xxxx**...9...**xxxxxxxx
x......xxxO.....Oxxx.....9x
x9.......xx*...*xx........x
xxxx......x*...*x......xx.x
x..xxx....xx...xx....xxx..x
x....xx....x...x....xx....x
x.....x....x...x....x.....x
x.....xx...x...x...xx.....x
x......x...x.......x......x
 9........9x9.....9x.....9
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 14 *, 10 monsters
NAME:   vaults_end_minmay_diagonal_split
TAGS:   vaults_end_quadrant unrand
SUBST:  9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 9xxx9.......x9..........
x..xxx...xx...x...........x
x...xxx..9xx...x..........x
x....xxx...xx...x9........x
x.x9..xxx...xx...x........x
x.xx...xxx..*xx...x.......x
x..xx...xxx..*xx...x......x
x...xx...xxx..*xx...x.....x
xx...xx...xxx..*xx...x9...x
x9x...xx*..xxx9.*xx...x...x
x..x...xx*..9O9..*xx...x..x
x...x...xx*.9xxx..*xx...x9x
x...9x...xx*..xxx...xx...xx
x.....x...xx*..xxx...xx...x
x......x...xx*..xxx...xx..x
x.......x...xx*..xxx...xx.x
x........x...xx...xxx..9x.x
x........9x...xx...xxx....x
x..........x...xx9..xxx...x
x...........x...xx...xxx..x
 ...........9x.......9xxx9
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 82 $, 16 monsters
NAME:    vaults_end_minmay_loops
TAGS:    vaults_end_quadrant vaults_end_quadrant_mall unrand
SHUFFLE: ae / bf / cg / dh
SUBST:   a = +, e = ., bcdfgh = x
SUBST:   9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 ..xxxxxx$$$$$$$$$xxxxx..
x......xxx$$$$$$$xxx......x
xx.9xx9.xxx$$$$$xxx.9xx9.xx
xx.xxxx.xxxx$$$xxxx.xxxx.xx
xx.xxxx.xxxxx$xxxxx.xxxx.xx
xx.9xx9..xxxx+xxxx..9xx9.xx
xxx......9xx9.9xx9......xxx
x$xxxx9.............9xxxx$x
x$$xxxx....9xax9....xxxx$$x
x$$$xxx....xxexx....xxx$$$x
x$$$$+.....dhOfb.....+$$$$x
x$$$xxx....xxgxx....xxx$$$x
x$$xxxx....9xcx9....xxxx$$x
x$xxxx9.............9xxxx$x
xxx......9xx9.9xx9......xxx
xx.9xx9..xxxx+xxxx..9xx9.xx
xx.xxxx.xxxxx$xxxxx.xxxx.xx
xx.xxxx.xxxx$$$xxxx.xxxx.xx
xx.9xx9.xxx$$$$$xxx.9xx9.xx
x......xxx$$$$$$$xxx......x
 ..xxxxxx$$$$$$$$$xxxxxx..
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# One shop, 16 monsters
NAME:    vaults_end_dpeg_shops1
TAGS:    vaults_end_quadrant vaults_end_quadrant_mall unrand
KFEAT:   S = any shop
: if crawl.one_chance_in(4) then
SUBST:   A = +, a = ., CD = x
: else
SHUFFLE: CD
SUBST:   C = ., DAa = x
: end
SUBST:   9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 ..xxxxxxxxxx.....xxxx...
x...xxxxx.................x
xx........................x
xxx......................xx
xxxx.....................xx
xxxx.....................xx
xxx......9xxxxxxx........xx
xx......9xxxxxxxxx.......xx
xx......xxx$999$xxx.......x
xx......xC.9$$$9.xx.......x
x.......CC.9$S$9Oxx.......x
x.......xC.9$$$9.xx......xx
x.......xAa$999$xxx......xx
xx.......xAxDDDxxx9......xx
xx........xxxDxxx9......xxx
xx.....................xxxx
xx.....................xxxx
xx......................xxx
x........................xx
x.................xxxxx...x
 ....xxxx.....xxxxxxxxxx..
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# Consumable shops (scrolls, potions, food).
# Monsters in rooms.
NAME:    vaults_end_dpeg_shops2
TAGS:    vaults_end_quadrant vaults_end_quadrant_mall unrand
NSUBST:  A = 1:+ / *:x+
NSUBST:  B = 1:+ / *:x+
NSUBST:  C = 1:+ / *:x+
NSUBST:  S = 3:S / 1:O / *:S99
KFEAT:   S = scroll shop / distillery shop / food shop
NSUBST:  ' = 20:9 / *:.
NSUBST:  . = 5:9 / *:.
SUBST:   9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 .........................
x.........................x
x...xxxxx..xxxxx..xxxxx...x
x...x'S'x..x'S'x..x'S'x...x
x...x'''x..x'''x..x'''x...x
x...xx+xx..xx+xx..xx+xx...x
x.........................x
x.........................x
x...xxAxx..xxBxx..xxCxx...x
x...x'''x..x'''x..x'''x...x
x...x'S'x..x'S'x..x'S'x...x
x...x'''x..x'''x..x'''x...x
x...xxAxx..xxBxx..xxCxx...x
x.........................x
x.........................x
x...xx+xx..xx+xx..xx+xx...x
x...x'''x..x'''x..x'''x...x
x...x'S'x..x'S'x..x'S'x...x
x...xxxxx..xxxxx..xxxxx...x
x.........................x
 .........................
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 20 *, 20 monsters
NAME:   vaults_end_minmay_plus_grid
TAGS:   vaults_end_quadrant unrand
NSUBST: * = 1:O / *:*
SUBST:  * = 9 8 *:20 .
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 xxx.x.*.x.xxx.x.*.x.xxx.
x.x.*.x.xxx.x.*.x.xxx.x...x
.*.x.xxx.x.*.x.xxx.x.*.x.xx
x.xxx.x.*.x.xxx.x.*.x.xxx.x
xx.x.*.x.xxx.x.*.x.xxx.x.*x
x.*.x.xxx.x.*.x.xxx.x.*.x.x
xx.xxx.x.*.x.xxx.x.*.x.xxxx
xxx.x.*.x.xxx.x.*.x.xxx.x.x
xx.*.x.xxx.x.*.x.xxx.x.*.xx
x.x.xxx.x.*.x.xxx.x.*.x.xxx
xxxx.x.*.x.xxx.x.*.x.xxx.xx
x.x.*.x.xxx.x.*.x.xxx.x.*.x
x*.x.xxx.x.*.x.xxx.x.*.x.xx
x.xxx.x.*.x.xxx.x.*.x.xxx.x
xx.x.*.x.xxx.x.*.x.xxx.x.*x
x.*.x.xxx.x.*.x.xxx.x.*.x.x
xx.xxx.x.*.x.xxx.x.*.x.xxxx
xxx.x.*.x.xxx.x.*.x.xxx.x.x
xx.*.x.xxx.x.*.x.xxx.x.*.xx
..x.xxx.x.*.x.xxx.x.*.x.xxx
 xxx.x.*.x.xxx.x.*.x.xxx.x
  xxxxxxxxxxxxxxxxxxxxx..
ENDMAP

############################################################
# 14 *, 12 monsters
NAME:   vaults_end_minmay_curved1
TAGS:   vaults_end_quadrant unrand
SUBST:  9 = 8 9 .:20
NSUBST: O = 1:O / *:*
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  x.x.xxxxxxxxxxxxxxxxxxx
 .................xxxxxx.
x.xxxx....xxxx.......xx...x
....9xxx....9xxx.........xx
x.....9xx.....9xx.......xxx
x......9x......9x.......xxx
x.......xx......xx.......xx
x.......9x......9x.......xx
x........x.......x9......xx
x.xxxx...xxxxx***xx.......x
x...9xxx.*xxxxxxO*x9......x
x.....9xx*xxxxxxx*xx9.....x
x......9x*Oxxxxxx*.xxx9...x
x.......xx***xxxxx...xxxx.x
xx......9x.......x........x
xx.......x9......x9.......x
xx.......xx......xx.......x
xxx.......x9......x9......x
xxx.......xx9.....xx9.....x
xx.........xxx9....xxx9....
x...xx.......xxxx....xxxx.x
 ..xxxxxx.................
  xxxxxxxxxxxxxxxxxxx.x.x
ENDMAP

############################################################
# 18 *, 20 monsters
NAME:   vaults_end_minmay_broken_lines
TAGS:   vaults_end_quadrant unrand
SUBST:  9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 .9.x.x.x.x.x.x.x.9.x.x...
x.x.x.x.x.x.x*x.x.x.x.x...x
x.x.x.x.9.x.9*x.x.x.9.x.x.x
x.x.9.x.x.x.x*x.x.x.x.x.x.x
x.x.x.x.x.9.x*x.9.x.x.9.x.x
x.x.x.9.x.x.x*x.x.x.x.x.x.x
x.x.x.x.x.x.x*9.x.x.x.9.x.x
x.x.x.x.9.x.x*x.x.9.9.x.x.x
x.x.x.x.x.x.9*x.x.x.x.x.x.x
x.x.x.x.x.x.x*x.x.x.x.x.9.x
x.x.x.x.x.x.xO9.x.x.x.x.x.x
x.x.9.x.x.9.x*x.x.9.x.x.x.x
x.x.x.x.x.x.x*x.x.x.x.9.x.x
x.x.x.x.9.x.x*9.x.x.x.x.x.x
x.x.x.x.x.x.x*x.x.x.x.x.9.x
x.x.x.9.x.9.x*x.9.x.9.x.x.x
x.x.9.x.x.x.9*x.x.x.x.9.x.x
x.x.x.x.x.x.x*9.x.x.x.x.x.x
x.x.x.9.x.x.x*x.x.x.x.x.x.x
x.x.x.x.x.x.x*x.x.9.x.x.9.x
 .9.x.x.x.9.9.x.x.x.9.x...
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 16 *, 12 monsters
NAME:    vaults_end_minmay_surrounding_squares
TAGS:    vaults_end_quadrant unrand
SHUFFLE: AB
SUBST:   9 = 8 9 .:20
SUBST:   A = ., B = x
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 9......................9
x.9xx.xxx.xxx.xxx.xxx.xx.9x
x.xxx.xxx.xxx.xxx.xxx.xxx.x
x.xxx.xxx.xxx.xxx.xxx.xxx.x
x.........................x
x.xxx.9xxxxxxAxxxxxx9.xxx.x
x.xxx.xx...........xx.xxx.x
x.xxx.x.9xxxxBxxxx9.x.xxx.x
x.....x.xx9.....9xx.x.....x
x.xxx.x.x9.*****.9x.x.xxx.x
x.xxx.B.A.***O***.A.B.xxx.x
x.xxx.x.x9.*****.9x.x.xxx.x
x.....x.xx9.....9xx.x.....x
x.xxx.x.9xxxxBxxxx9.x.xxx.x
x.xxx.xx...........xx.xxx.x
x.xxx.9xxxxxxAxxxxxx9.xxx.x
x.........................x
x.xxx.xxx.xxx.xxx.xxx.xxx.x
x.xxx.xxx.xxx.xxx.xxx.xxx.x
x.9xx.xxx.xxx.xxx.xxx.xx9.x
 9.......................9
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 4 |, 15 *, 18 monsters
NAME:   vaults_end_minmay_split_center
TAGS:   vaults_end_quadrant unrand
SUBST:  9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
  .......................
x.........................x
x..xxxx999xxxxxxx999xxxx..x
x..9..xxx..xxOxx..xxx..9..x
x..9....xx..x*x..xx....9..x
x..xxxx..xx.x*x.xx..xxxx..x
x..9..xx..x|x*x|x..xx..9..x
x..xx..xx.xxx*xxx.xx..xx..x
x..9xx..x..xx*xx..x..xx9..x
x..9....xx.xx*xx.xx....9..x
x..xxxx....xx*xx....xxxx..x
x..9..xxx...x*x...xxx..9..x
x..9....xx...*...xx....9..x
x..xxxx..xx.x*x.xx..xxxx..x
x..9..xx..x|x*x|x..xx..9..x
x..xx..xx.xxx*xxx.xx..xx..x
x..9xx..x..xx*xx..x..xx9..x
x..9.xx.x..xx*xx..x.xx.9..x
x..x99x9x99xxxxx99x9x99x..x
x.........................x
 .........................
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 16 *, 12 monsters
NAME:   vaults_end_minmay_sharp_edges
TAGS:   vaults_end_quadrant unrand
SUBST:  9 = 8 9 .:20
NSUBST: O = 1:O / *:*
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 ..x9xxx9xxx9xxx9xxx9xxx.
x.....x...x...x...x...x...x
xx.......................xx
x9....x.................xxx
xx...xxx.................xx
xxx.xxxxx..x......x......9x
xx...xxx..xxx....xxx.....xx
x9....x..xxOxx..xxxxx...xxx
xx......xxO**xx..xxx.....xx
xxx......xx***xx..x......9x
xx........x9***xx........xx
x9......x..99***xx......xxx
xx.....xxx..99**Oxx......xx
xxx...xxxxx..xxOxx..x....9x
xx.....xxx....xxx..xxx...xx
x9......x......x..xxxxx.xxx
xx.................xxx...xx
xxx.................x....9x
xx.9.....................xx
x...x...x...x...x...x.....x
 ..xxx9xxx9xxx9xxx9xxx9x..
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 20 *, 14 monsters
NAME:   vaults_end_minmay_outlined_triangles
TAGS:   vaults_end_quadrant unrand
SUBST:  9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 ........................
x...x.x.x..x.x.x..x.x.x...x
x....9.9....9.9....9.9....x
x...x.x.....x.x.....x.x...x
x....9.......9.......9....x
x...x........x........x...x
x.........................x
x.........xxx9xxx.........x
x...x.....xx***xx.....x...x
x....9x...x*****x...x9....x
x...x..9x.9**O**9.x9..x...x
x....9x...x*****x...x9....x
x...x.....xx***xx.....x...x
x.........xxx9xxx.........x
x.........................x
x...x........x........x...x
x....9.......9.......9....x
x...x.x.....x.x.....x.x...x
x....9.9....9.9....9.9....x
x...x.x.x..x.x.x..x.x.x...x
 .........................
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 12 *, 11 monsters
NAME:   vaults_end_minmay_oval
TAGS:   vaults_end_quadrant unrand
SUBST:  9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 ........................
x.........................x
x..xxxxxxxxxx......xxxxx..x
x..xxxxxxx9..........xxx..x
x..xxxxx9.............xx..x
x..xxxx9...............x..x
x..xxx9..........***...x..x
x..xx9..........9xx*......x
x..xx.........9xxxx*......x
x..x9......9xxxxxx9....x..x
x..x.....9xxxxxxx9.....x..x
x..x....9xxxxxx9......9x..x
x......*xxxx9.*.......xx..x
x......*xx9..........9xx..x
x..x...O**..........9xxx..x
x..x*..............9xxxx..x
x..xx*............9xxxxx..x
x..xxx..........9xxxxxxx..x
x..xxxxx......xxxxxxxxxx..x
x.........................x
 .........................
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 12 *, 12 monsters
NAME:   vaults_end_minmay_fences
TAGS:   vaults_end_quadrant unrand
NSUBST: A = 1:+ / *:x, B = 1:+ / *:x
SUBST:  9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 ........................
x.........................x
x..xxx..x.x.x9x.x.x..xxx..x
x..x9.................9x..x
x..x...................x..x
x.......x.x.x9x.x.x.......x
x......9x.........x9......x
x..x..xxx...*.*...xxx..x..x
x..........xxAxx..........x
x..x..x...*x*9*x*...x..x..x
x..9..9...*A9O9A....9..9..x
x..x..x....x*9*x*...x..x..x
x..........xxAxx..........x
x..x..xxx...*.*...xxx..x..x
x......9x.........x9......x
x99.....x.x.x9x.x.x.......x
xBBx...................x..x
x..B9.................9x..x
x..xBx..x.x.x9x.x.x..xxx..x
x....B9...................x
 ....B9...................
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 17 *, 2 |, 14 monsters
NAME:   vaults_end_minmay_wings
TAGS:   vaults_end_quadrant unrand
SUBST:  9 = 8 9 .:20
NSUBST: O = 1:O / *:|
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 ............9...........
x............9............x
xxxxx9999xx.....xx9999xxxxx
x**xx....xx.....xx....xx**x
x***xx....xx...xx....xx***x
x...xx....xx...xx....xx...x
x....xx....xx.xx....xx....x
x....xx....xx.xx....xx....x
x.....xx....x.x....xx.....x
x|....xx....x.x....xx.....x
xO....99....9*9....99....Ox
x.....xx....xxx....xx....|x
x.....xx....xxx....xx.....x
x....xx....xx.xx....xx....x
x....xx....xx.xx....xx....x
x...xx....xx...xx....xx...x
x*..xx....xx...xx....xx..*x
x**xx....xx.....xx....xx**x
xxxxx9999xx.....xx9999xxxxx
x........9.......9........x
 ........9.......9........
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 16 *, 1 |, 13 monsters
NAME:   vaults_end_minmay_cones
TAGS:   vaults_end_quadrant unrand
SUBST:  9 = 8 9 .:20
NSUBST: O = 1:O / *:|
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 ........................
x.xx........xx.......xx...x
x......xx...9....xx...9...x
x..xx..9.....xx.....xx.9x.x
x........xx..9...xx.9.x.x.x
x....xx.......xx.....9x...x
xxx...9....xx.9..xx.......x
x.......xx.....xx9.x.x.x..x
x....xx.9...xxx...9x.x.x..x
x.xx......xxx9....x.......x
x.......xxx...xx..x.x.....x
x*****xxx9...xxx.x.9x.x...x
x***xxx.....xxx.9x...9x.x.x
xOxxx9....9xxx..x..x...9x.x
xxx.......xxx...x..x......x
x.......9xxx9..x.....x....x
x.......xxx...9x..x..x....x
x......xxx9...x..9x....x..x
x.....xxx*....x.......9x..x
x....xxx***..x...x.9x.....x
 ...xxxO****9x...x..x.....
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

# 19 *, 12 monsters
NAME:   vaults_end_grunt_pinched
TAGS:   vaults_end_quadrant unrand
NSUBST: O = 1:O / *:.
SUBST:  9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 ........x...............
x.......xx...9............x
x...9...xx...x............x
x......xx....xx....9......x
x.....xx9....*x...........x
x...xxxxx....*xx..........x
x9xxxx.xxx....9xx......9..x
x.......xx..9.*xxxx.......x
x...9....9..**xx.9xxx.....x
x.9.x**....*Oxx*...xxxx...x
x...xxxx...*xx*.....**x.9.x
x.....xxx9*xxO*...9.......x
x.......xxxx**............x
x..9....xxx*..............x
x......xxxxx9..9.xx..9.xx9x
x.....xx...xx*...xxxxxxxx.x
x....xx.....x*....xxxx....x
x...xx......xx....xx......x
x..xx....9...x.9..x....9..x
x.xx.........9...xx.......x
 ................x........
  .xxxxxxxxxxxxxxxxxxxxxx
ENDMAP

# 18 *, 12 monsters
NAME:    vaults_end_grunt_door_to_door
TAGS:    vaults_end_quadrant unrand
SHUFFLE: 456
NSUBST:  1 = 1:9 / *:*
NSUBST:  2 = 1:9 / *:*
NSUBST:  3 = 1:9 / *:*
NSUBST:  4 = 1:9 / *:*
NSUBST:  5 = 1:9 / *:*
NSUBST:  6 = 1:O / *:*
SUBST:   9 = 8 9 .:30
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 +xxxxxxxxxxxxxxxxxxxxxxx
xx..........xxx.........+xx
x.9..+xx+..9.+.9..+xx+..9.x
x....x11x....x....x22x....x
x....x11x....x....x22x....x
x.9..+xx+..9.+.9..+xx+..9.x
xx..........xxx..........xx
xx+xx+xx+xx+xxx+xx+xx+xx+xx
xx..........xxx..........xx
x.9..+xx+..9.x.9..+xx+..9.x
x....x44x....x....x33x....x
x....x44x....x....x33x....x
x.9..+xx+..9.+.9..+xx+..9.x
xx..........xxx..........xx
xx+xx+xx+xx+xxx+xx+xx+xx+xx
xx..........xxx..........xx
x.9..+xx+..9.+.9..+xx+..9.x
x....x55x....x....x66x....x
x....x55x....x....x66x....x
xx9..+xx+..9.+.9..+xx+..9xx
 +x.........xxx.........x+
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

# 17 *, 12 monsters
NAME:   vaults_end_grunt_cloverleaf
TAGS:   vaults_end_quadrant unrand
SUBST:  9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 ...+xxxxxxxxxxxxxxxxx+..
x.xxx....xxxxxxxxx....xxx.x
x+x....9..*xxxxx*..9....x+x
xx...9.....xxxxx.....9...xx
xx.........*xxx*.........xx
xx.9........xxx........9.xx
xx........9..x..9........xx
xxx*.........+.........*xxx
xxxxx*...9.+xxx+.9...*xxxxx
xxxxxxxx...x.9.x...xxxxxxxx
xxxxxxxxx+xx9O9xx+xxxxxxxxx
xxxxxxxx...x*9.x...xxxxxxxx
xxxxx*...9.+xxx+.9...*xxxxx
xxx*.........+.........*xxx
xx........9..x..9........xx
xx.9........xxx........9.xx
xx..........xxx..........xx
xx...9.....*xxx*.....9...xx
x+x....9..*xxxxx*..9....x+x
x.xxx....xxxxxxxxx....xxx.x
 ...+xxxxxxxxxxxxxxxxx+...
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

# 20 *, 14 monsters
NAME:   vaults_end_grunt_tight_spiral
TAGS:   vaults_end_quadrant unrand
SUBST:  9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 ..xx........9........xx.
x..x....xxxxxxxxxxxxx..x..x
xx....9xx....9......9....xx
xxx.x9.x..xxxxxxxxxx.9..xxx
xx..x.xx.xx..9.....xxx...xx
xx..x.x..x..xxxxxx...xx..xx
xx..x.x.xx.xx9...xxx..x..xx
xx..x.x.x..xx*xx...xx.x..xx
x...x.x.x.xx***xxx..x.x...x
x...x.x.x.x*9*9*xxx.x.x...x
x..9x9x9x9***O***9x9x9x9..x
x...x.x.xxx*9*9*x.x.x.x...x
x...x.x..xxx***xx.x.x.x...x
xx..x.xx...xx*xx..x.x.x..xx
xx..x..xxx...9xx.xx.x.x..xx
xx..xx...xxxxxx..x..x.x..xx
xx...xxx.....9..xx.xx.x..xx
xxx..9.xxxxxxxxxx..x.9x.xxx
xx....9......9....xx9....xx
x..x..xxxxxxxxxxxxx....x..x
 ..xx........9........xx..
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

# 18 *, 12 monsters
NAME:   vaults_end_grunt_simple_division
TAGS:   vaults_end_quadrant unrand
SUBST:  9 = 8 9 .:20
NSUBST: O = 1:O / *:*
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 ..9.........+.........9.
x...........xxx...........x
x9.........xxOxx.........9x
x....9....xx***xx.....9...x
x.......xxx.9.9.xxx.......x
x......+x.........x+......x
x.....x+...........+x.....x
x...xxx.............xxx...x
x..xx........9........xx..x
x.xx*9......*........9*xx.x
x+xO*......9.*.9......*Ox+x
x.xx*9........*......9*xx.x
x..xx........9........xx..x
x...xxx.............xxx...x
x.....x+...........+x.....x
x......+x.........x+......x
x.......xxx.9.9.xxx.......x
x....9....xx***xx.....9...x
x9.........xxOxx.........9x
x...........xxx...........x
 ..9.........+.........9..
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

# 20 *, 14 monsters
NAME: vaults_grunt_end_bulge
TAGS: vaults_end_quadrant unrand
NSUBST: O = 1:O / *:*
SUBST: 9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxx.
 ..xxx.9.................
x..xxx.....9..........xx...
x..xxx.9...........9xxxxx.x
x..xxxx.........xxx.xxxxx.x
x....xxxx....xxxxxx+xxxx..x
x.....xxxx9.xxxxx....+.9..x
x..9...xxxxxxx**..9..xx...x
x9...9..xxxxx*.....*xxx...x
x......xxxxO*..9..*xxx....x
x......xxx*.9.....*xx.....x
x.....xxx*.......*xxx.....x
x..9.xxx*.....9.*xxx....9.x
x....xxx*..9...Oxxx9......x
x....xx*.....**xxxx.......x
x.9.xx..9..**xxxxxxx......x
x....+.....xxxx.xxxxx.....x
x..xxxx+xxxxxx....xxxx....x
x.xxxxx.xxx.....9...xxxx..x
x.xxxxx...........9..xxx..x
x9.xx.......9...9....xxx..x
 .9.....9............xxx..
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

# 18 *, 12 monsters
NAME:  vaults_end_grunt_zigzag
TAGS:  vaults_end_quadrant unrand
SUBST: 9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxx.
 ..9...9xxx9***9xxx....9..
x....9.xxx.....*xx..xxxx9..
x.....xx...xx..xx..xx*Ox.9x
x....xx..xxx..xx..xx***x..x
x.x.xx..xx...xx..xx9**xx..x
x.x....xx..xxx..xx.9xxx...x
x.x9.xxx..xx...xx..xx...xxx
x.x.xx...xx..xxx..xx..xxx9x
x.xxx..xxx..xx...xx..xx.**x
x.xx..xx...xx..xxx..xx...*x
x.x..xx..xxx9.xx...xx..x.*x
x.x.xx..xx...xx..xxx..xx.9x
x.x....xx..xxx..xx...xx..xx
x.x.9.xx..xx...xx..xxx..xxx
x.xx...9.xx..xxx..xx...xxxx
x9*xxx...x..xx...xx..xxx.9x
x..*xxxx...xx..xxx..xx....x
xx..9xxx..xx..xx...xx...9.x
xx...*xx.9...xx..9....xx..x
x.....*xxxxxxxxxxxxxxxx..9x
 ..xx.9...................
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 16 * (2.667 |), 10 monsters, 8 $
NAME:   johnstein_vaults_end_maze
TAGS:   vaults_end_quadrant unrand
SUBST:  9 = 8 9 .:20
NSUBST: O = 1:O / *:*
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 ........................
x.xxx.................xxx.x
x.x*xxxxxx...9...xxxxxx*x.x
x.xx*$9..xxxx.xxxx..9$*xx.x
x..x$.......x.x.......$x..x
x..x9...xxx..9..xxx...9x..x
x..xx.x.xOxxxxxxxOx.x.xx..x
x...x.x.xx..xxx..xx.x.x...x
x...x.x.x..x.9.x..x.x.x...x
x...x.x.x.x9*x*9x.x.x.x...x
x....9x...x.xOx.x...x9....x
x...x.x.x.x9*x*9x.x.x.x...x
x...x.x.x..x.9.x..x.x.x...x
x...x.x.xx..xxx..xx.x.x...x
x..xx.x.xOxxxxxxxOx.x.xx..x
x..x9...xxx..9..xxx...9x..x
x..x$.......x.x.......$x..x
x.xx*$9..xxxx.xxxx..9$*xx.x
x.x*xxxxxx...9...xxxxxx*x.x
x.xxx.................xxx.x
 .........................
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

###############################################################################
# Vaults:$ prize quadrants
###############################################################################

############################################################
# 11 |, 12 *, 15 monsters
NAME:   vaults_end_minmay_curved2
TAGS:   vaults_end_quadrant_prize unrand
SUBST:  9 = 8 9 .:20
NSUBST: O = 1:O / *:|
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 ......x|****...9xxx.....
x......xO|*||...xx9.......x
x......xx|*....9x........xx
x...x...xxx....xx........xx
x...x..........x9......9xxx
x...x9........9x.....9xxx9x
x...xx........xx...xxxx9..x
x....x9......9x..xxx9.....x
x....xx9....9xx.xx9.......x
x.....xxx99xxx..x9......|*x
x.......xxxx...xx.......|*x
x..............x9.....x***x
x...xxxx.......x9.....x||*x
x.....9xxx.....xx.....xxO|x
x.......9xx.....x9.....xxxx
xxxx.....9x.....xx9.......x
x..xx.....xx.....xxx9.....x
x...x.....9x.......xxxx...x
x...x.....9x..............x
x.........xx..............x
 ........9x...............
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 31 *, 18 $, 20 monsters
NAME:    vaults_end_minmay_connected_circles
TAGS:    vaults_end_quadrant_prize unrand
SUBST:   9 = 8 9 .:20
NSUBST:  * = 1:O / *:*
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 x.9.xxxxxx*9xxxxxxxxxxxx
x.....xxxx9..*xxxxxxxxxx.xx
x9.$.9xxxx*..9xxxxxxxxx.xxx
x.....xxx.x9*xxxxxxxxx.xxxx
xx.9.xxx.xxxx.xxx.9.x.xxxxx
xxx.xxx.xx$9xx.x.....xxxxxx
xxxx.x.xx$*$9xx.9.$.9xxxxxx
xxx.9.xxx9$*$xxx.....xxxxxx
xx.$.$.x.x9$*$xxx.9.x.xxxxx
xx9.$.9.xxxx$*$xxx.xxx.xxxx
xx.$.$.x.xxxx$x.x.xxxxx*9xx
xxx.9.xxx.xxxxxx.xxxxx9..*x
xxxxxxxxxx.xxxx.xxxxx.*..9x
xxx9*.*xxxx*9x.xxxxx.xx9*xx
xx.*.*.*xx9..*xxxxx.xxxxxxx
x........x*..9xxxx.xxx.9xxx
x.......9xx9*xx*9*xxx.$.9xx
x9.......x.xxx*.*.*xx9...xx
x.........xxxx9*.*9x.x9..xx
x.......xxxxxx*.*.*.xxx...x
 x....9xxxxxxxx*9*xxxxxx.x
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 3 |, 24 *, 18 monsters
NAME:   vaults_end_minmay_x
TAGS:   vaults_end_quadrant_prize unrand
SUBST:  9 = 8 9 .:20
NSUBST: O = 1:O / *:|
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 ........................
x..xx9...............9xx..x
x..xxx...............xxx..x
x..9xxx.............xxx9..x
x....xxx...........xxx....x
x.....xxx.........xxx.....x
x......xxx9999999xxx......x
x......9xxx*****xxx9......x
x......9*xxx***xxx*9......x
x......9**xxxOxxx**9......x
x......9**OxxxxxO**9......x
x......9**xxxOxxx**9......x
x......9*xxx***xxx*9......x
x......9xxx*****xxx9......x
x......xxx9999999xxx......x
x.....xxx.........xxx.....x
x....xxx...........xxx....x
x..9xxx.............xxx9..x
x..xxx...............xxx..x
x..xx9...............9xx..x
 .........................
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 8 |, 20 *, 16 monsters
NAME:   vaults_end_minmay_split_x
TAGS:   vaults_end_quadrant_prize unrand
SUBST:  9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 .9......9xxxxxxx9.......
x9.........xxxxx..........x
x..xxxxx....xxx....xxxxx..x
x..xxx..x...9x9...x..xxx..x
x..xx|...x.......x...|xx..x
x..x..9...x.....x...9..x..x
x..x...9..x.....x..9...x..x
x...x...|xx9...9xx|...x...x
x9...x..xxxx***xxxx..x...9x
xx....xxxxx*****xxxxx....xx
xxx9..xxxxx**O**xxxxx..9xxx
xx....xxxxx*****xxxxx....xx
x9...x..xxxx***xxxx..x...9x
x...x...|xx9...9xx|...x...x
x..x...9..x.....x..9...x..x
x..x..9...x.....x...9..x..x
x..xx|...x.......x...|xx..x
x..xxx..x...9x9...x..xxx..x
x..xxxxx....xxx....xxxxx..x
x9.........xxxxx.........9x
 .9......9xxxxxxx9......9.
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 18 |, 12 *, 21 monsters
NAME:   vaults_end_minmay_slanted
TAGS:   vaults_end_quadrant_prize unrand
SUBST:  9 = 8 9 .:20
NSUBST: O = 1:O / *:|
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 ...............9..**|xxxx
x......xxxx..9..9..xxxx....
x...xxxx..9..9..xxxx......x
xxxxx.....9..xxxx.........x
x.........xxxx..9.........x
x......xxxx..9..9..xxxx999x
x999xxxx..9..9..xxxx......x
x.........9..xxxx.........x
x.........xxxx||......xxxxx
x|.....xxxx||O||999xxxx***x
x***xxxx999||O||xxxx.....|x
xxxxx......||xxxx.........x
x.........xxxx..9.........x
x......xxxx..9..9..xxxx999x
x999xxxx..9..9..xxxx......x
x.........9..xxxx.........x
x.........xxxx..9.....xxx.x
x|.....xxxx..9..9..xxxx...x
x***xxxx..9..9..xxxx......x
xxxxx.....9..xxxx.........x
 .........xxxx|**.........
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 16 |, 14 *, 20 monsters
NAME:    vaults_end_minmay_not_circular
TAGS:    vaults_end_quadrant_prize unrand
SHUFFLE: abcd
SUBST:   a : ., b : x .:1, c : x .:1, d : x .:1
SUBST:   9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
  ................xxxxxx..
x...................9xx...x
x.....................9..xx
x.......9xxcccccxx.....9xxx
x....9xxxx9.....9xxxx...xxx
x...9xx9...........9xx..9xx
x...xx...............xx..xx
x..9x9...xxaaaaaxx...9x..xx
x..xx..xxx9.*.*.9xxx..xx..x
x..d9.xx9**|||||**9xx.9b..x
x..d..b..*|||O|||*..d..b.*x
x..d9.xx9**|||||**9xx.9b.*x
x..xx..xxx9.*.*.9xxx..xx.*x
xx..x9...xxcccccxx...9x..xx
xx..xx...............xx..xx
xx9..xx9...........9xx..9xx
xxx...xxxx9.....9xxxx...xxx
xxx9.....xxaaaaaxx.....9xxx
xx..9.................9..xx
x...xx9.............9xx...x
 ..xxxxxx**......*xxxxxx..
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# about 21 |, 29 *
NAME:   vaults_end_mu_corners
TAGS:   vaults_end_quadrant_prize unrand
SUBST:  9 = 8 9 .
NSUBST: $ = 1:O / *:$
SUBST:  $ = | *:15 $:5
SUBST:  a = x.
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 ....x.......x99...x......
x....x.......x99...x..x...x
x....x..xxx..x..x..x..x...x
x.xxxx..xxx..x..x..x..x...x
x.......xxx..x..x..x..xxxxx
x.......xxx.....x99.......x
xxxxxx..xxx.....x99.......x
x.......xxxxx+xxxxxxxxxx..x
x.......x99x$$$$$$x99.....x
x..xxxxxx99x$$$$$$x99.....x
x99........x$$$$$$x..xxxxxx
x99........x$$$$$$x.......x
xxxxxx..x..x$$$$$$x.......x
x.......x..xxxxxxxxxxxxx..x
x.......x...............99x
x..xxxxxx...............99x
x99.....x..xxxx+xxxx..xxxxx
x99.....x..x$$$$$$$x..x...x
xxxxxx..x..x$$$$$$$x..x...x
a.......x99x$$$$$$$x..x...x
 .......x99x$$$$$$$x......
  axxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# about 21 |
NAME:   vaults_end_mu_flips
TAGS:   vaults_end_quadrant_prize unrand
NSUBST: ; = 3:l / 3:z / 3:A / *:.
SUBST:  9 = 8 9
SUBST:  $ = | * $
KFEAT:  l = teleport trap
KFEAT:  z = zot trap
KFEAT:  A = alarm trap
SUBST:  s = x:250 +:1
SUBST:  a = x.
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 ........................
x.99xxxxxxxxxxxxxxxxxxxxs.x
x.9999..................x.x
x.x9xxxxxxxxxxxxxxxxxxs.x.x
x.x9x999..............x.x.x
x.x.x999xxxxxxxxxxxxs.x.x.x
x.x.x999;;;;;;;;$$$$x.x.x.x
x.x.x.x;;;;;;;;;$$$$x.x.x.x
x.x.x.x;;;;;;;;;$$$$x.x.x.x
x.x.x.x;;;;;;;;;$$$$x.x.x.x
x.x.x.x;;;;;;;;;$$$$x.x.x.x
x.x.x.x;;;;;;;;;$$$$x.x.x.x
x.x.x.x$$$$$$$$$$$$$x.x.x.x
x.x.x.x$$$$$$$$$$$$$x.x.x.x
x.x.x.x$$$$$$$$$$$$Ox.x.x.x
x.x.x.sxxxxxxxxxxxxxx.x.x.x
x.x.x................999x.x
x.x.sxxxxxxxxxxxxxxxx999x.x
x.x..................999x.x
x.sxxxxxxxxxxxxxxxxxxxxxx.a
 ........................
  xxxxxxxxxxxxxxxxxxxxxxa
ENDMAP

############################################################
# about 21 |
NAME:   vaults_end_mu_construction
TAGS:   vaults_end_quadrant_prize unrand
NSUBST: $ = 1:O / *:$
SUBST:  $ = |*$.
SUBST:  c = xn9.
SUBST:  9 = 8 9 .
NSUBST: D = 1:+ / *:x
NSUBST: E = 1:+ / *:x
NSUBST: F = 1:+ / *:x
NSUBST: G = 1:+ / *:x
SUBST:  a = xn..
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  axxxxxxxxxxxxxxxxxxxxxa
  .c.c.c..x$$$$$x..c.c.c..
a.c.c.c.c.+$$$$$+.c.c.c.c.a
xc.c.c.c..x$$$$$x..c.c.c.cx
x.c.c.c.c.xxxxxxx.c.c.c.c.x
xc.c.c.c.cx$$$$$xc.c.c.c.cx
x.c.c.c.c.x$$$$$x.c.c.c.c.x
xc.c.c.c.cx$$$$$xc.c.c.c.cx
x.c.c.c.c.x$$$$$x.c.c.c.c.x
xDxDxDxDxDxxx+xxxExExExExEx
x.........x$$$$$x.........x
x.x9.x..x.+$$9$$+.x..x.9x.x
x.........x$$$$$x.........x
xFxFxFxFxFxxx+xxxGxGxGxGxGx
x.c.c.c.c.x$$$$$x.c.c.c.c.x
xc.c.c.c.cx$$$$$xc.c.c.c.cx
x.c.c.c.c.x$$$$$x.c.c.c.c.x
xc.c.c.c.cx$$$$$xc.c.c.c.cx
x.c.c.c.c.xxxxxxx.c.c.c.c.x
xc.c.c.c..x$$$$$x..c.c.c.cx
a.c.c.c.c.+$$$$$+.c.c.c.c.a
 ..c.c.c..x$$$$$x..c.c.c..
  axxxxxxxxxxxxxxxxxxxxxa
ENDMAP

############################################################
# about 19 |
NAME:   vaults_end_mu_triangles
TAGS:   vaults_end_quadrant_prize unrand
SUBST:  9 = 8 9 .:20
NSUBST: ? = 1:O / *:|
SUBST:  " = +:1 x:99
SUBST:  ! = x:20 .
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  x.xxxxxxxxxxxxxxxxxxxxx
 .........................
x.!x..9..xx............x!.x
...xx.....xx.9...9..9.xx..x
x...xx..9..xx........xx.9.x
x....xx.....xx.9..9.xx....x
x..9..xx..9..xx****xx.9...x
x......xx.....xx**xx......x
x....9..xx..9.."xxx|9.....x
x........xx.....xx||....9.x
x......9.|x"..9.."x|9.....x
x..9.....*|xx.....xx......x
x......9.|xxx"..9..xx.9...x
x........xx||xx.....xx....x
x....9..xx||||xx..9..xx.9|x
x......xx..9.9.xx.....xx||x
x..9..xx........xx..9..xx?x
x....xx..9.....9.xx.....xxx
x...xx............xx..9..xx
x..xx..9....9....9.xx.....x
x.!x...............|xx....x
 ..................|?xx...
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# Two guaranteed good shops. Perhaps more shops.
# Almost all monsters are in the rooms.
NAME:    vaults_end_dpeg_mall
TAGS:    vaults_end_quadrant_prize vaults_end_quadrant_prize_mall unrand
SHUFFLE: AB, CD
SUBST:   A=+, B:xx+, C:xxx+, D:xxxx+
NSUBST:  S = 2:S / 1:O / *:RRU9
KFEAT:   S = jewellery shop / antique armour shop / gadget shop
KFEAT:   R = general shop / book shop / scroll shop / antique weapon shop / distillery shop
KFEAT:   U = stone_arch
NSUBST:  ' = 22:9 / *:.
NSUBST:  . = 2:9 / *:.
SUBST:   9 = 8 9
SUBST:   a : x.
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  aaxxxxxxxxxxxxxxxxxxxaa
 .........................
a.........................a
a..................xxx....a
x..............x+++xxx....x
x..........x+++x'''xxx....x
x..........x'''D'S'xx.....x
x..........x'S'D'''xx.....x
x........xxx'''xxxxxx.....x
x........xxxBBBxxxxxx.....x
x........xx''''xx.........x
x......T.xx'ST'xx.T.......x
x........xx''''xx.........x
x....xxxxxxAAAxxx.........x
x....xxxxxx'''xxx.........x
x....xx'''C'S'x...........x
x....xx'S'C'''x...........x
x...xxx'''x+++x...........x
x...xxx+++x...............x
a...xxx...................a
a.........................a
 ........................
  aaxxxxxxxxxxxxxxxxxxxaa
ENDMAP

############################################################
# 26 *, 16 monsters
NAME:   vaults_end_minmay_bent_boxes
TAGS:   vaults_end_quadrant_prize unrand
SUBST:  9 = 8 9 .:20
NSUBST: O = 1:O / *:|
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 .....9............9.....
x.....9............9......x
x.....xxxxxxxxxxxxxx......x
x................9.xx.....x
x................9..xx....x
x99x.....xxxxxxxxx...xx...x
x..x....xx.9..........xx99x
x..x...xx*.9...........x..x
x..x..xx**.xxxxxxx..x99x..x
x..x..x...*******x..x..x..x
x..x..x99x***O***x99x..x..x
x..x..x..x*******...x..x..x
x..x99x..xxxxxxx.**xx..x..x
x..x...........9.*xx...x..x
x99xx..........9.xx....x..x
x...xx...xxxxxxxxx.....x99x
x....xx..9................x
x.....xx.9................x
x......xxxxxxxxxxxxxx.....x
x......9............9.....x
 ......9............9.....
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 28 *, 1 |, 20 monsters
NAME:   vaults_end_minmay_cup_spider
TAGS:   vaults_end_quadrant_prize unrand
SUBST:  9 = 8 9 .:20
NSUBST: O = 1:O / *:|
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 ........................
x.........................x
x..xxxx..xxxxxxxxx..xxxx..x
x.....x..9..*x*..9..x.....x
x.....x..9..*x*..9..x.....x
x..x99xxxxxxxxxxxxxxx99x..x
x..x..x**xO.....Ox**x..x..x
x..x**x..xx..x..xx..x**x..x
x..xxxx99xx99x99xx99xxxx..x
x........x.......x........x
x........x.......x........x
x..xxxx99xx99x99xx99xxxx..x
x..xxxx..xx..x..xx..xxxx..x
x..9.*x......x......x*.9..x
x..9.*x**....x....**x*.9..x
x..xxxxxxxx99x99xxxxxxxx..x
x..x**x**x*..x..*x**x**x..x
x..x..x..x*..x..*x..x..x..x
x..x99x99xxxxxxxxx99x99x..x
x.........................x
 .........................
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 11 |, 18 *, 20 monsters
NAME:   vaults_end_minmay_30_sandwiches
TAGS:   vaults_end_quadrant_prize unrand
SUBST:  9 = 8 9 .:20
NSUBST: | = 1:O / *:|
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 9...9...9...9...9...9...
x.x.x.xxx.x.x.xxx.x.x.xxx.x
x.x*x..*..x*x..*..x*x..*..x
x.x.x.xxx.x.x.xxx.x.x.xxx.x
x9...9...9...9...9...9...9x
x.xxx.x.x.xxx.x.x.xxx.x.x.x
x..*..x|x..|..x|x..|..x*x.x
x.xxx.x.x.xxx.x.x.xxx.x.x.x
x9...9...9...9...9...9...9x
x.x.x.xxx.x.x.xxx.x.x.xxx.x
x.x*x..|..x|x..|..x|x..*..x
x.x.x.xxx.x.x.xxx.x.x.xxx.x
x9...9...9...9...9...9...9x
x.xxx.x.x.xxx.x.x.xxx.x.x.x
x..*..x|x..|..x|x..|..x*x.x
x.xxx.x.x.xxx.x.x.xxx.x.x.x
x9...9...9...9...9...9...9x
x.x.x.xxx.x.x.xxx.x.x.xxx.x
x.x*x..*..x*x..*..x*x..*..x
x.x.x.xxx.x.x.xxx.x.x.xxx.x
 ....9...9...9...9...9...9
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 11 |, 16 *, 18 monsters
NAME:   vaults_end_minmay_small_xes
TAGS:   vaults_end_quadrant_prize unrand
SUBST:  9 = 8 9 .:20
NSUBST: | = 1:O / *:|
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 ........................
x.xx9..9xx.......xx9..9xx.x
x.xxx**xxx.......xxx**xxx.x
x.9xxxxxx9.xxxxx.9xxxxxx9.x
x..*xxxx*..x|||x..*xxxx*..x
x..*xxxx*..x|||x..*xxxx*..x
x.9xxxxxx9.xx+xx.9xxxxxx9.x
x.xxx**xxx.......xxx**xxx.x
x.xx9..9xx.xx9xx.xx9..9xx.x
x..........xxxxx..........x
x..........9xxx9..........x
x..........xxxxx..........x
x.xx9..9xx.xx9xx.xx9..9xx.x
x.xxx**xxx.......xxx**xxx.x
x.9xxxxxx9.xx+xx.9xxxxxx9.x
x..*xxxx*..x|||x..*xxxx*..x
x..*xxxx*..x|||x..*xxxx*..x
x.9xxxxxx9.xxxxx.9xxxxxx9.x
x.xxx**xxx.......xxx**xxx.x
x.xx9..9xx.......xx9..9xx.x
 .........................
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 11 |, 12 *, 16 monsters
NAME:   vaults_end_minmay_plusses
TAGS:   vaults_end_quadrant_prize unrand
SUBST:  9 = 8 9 .:20
NSUBST: | = 1:O / *:|
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 ..xx.....8x8.......8x8..
x..........x.........x....x
xx....x.........x.........x
xx...9x9.......9x9.......8x
x...xxxxx..x..xxxxx..x..xxx
x....9x9.......9x9.......8x
xxxx..x.........x.........x
x||x.......x.........x....x
x**x......9x9.......9x9...x
x.....x..xxxxx..x..xxxxx..x
x**x......9x9.......9x9...x
x||x.......x.........x....x
xxxx..x.........x.........x
x....9x9.......9x9.......8x
x...xxxxx..x..xxxxx..x..xxx
x....9x9.......9x9.......8x
x.....x.........x.........x
xx.......................xx
xx....xxxxx.....xxxxx....xx
x.......x||**.**||x.......x
 ..xx...x||**.**||x...xx..
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 11 |, 16 *, 16 monsters
NAME:   vaults_end_minmay_circles_and_squares
TAGS:   vaults_end_quadrant_prize unrand
SUBST:  9 = 8 9 .:20
NSUBST: O = 1:O / *:|
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 .........................
x..xx9..9xx.....xx9..9xx..x
x.xxxx..xxxx...xxxx..xxxx.x
x.xxxx..xxxx...xxxx..xxxx.x
x.9xx....xx9...9xx....xx9.x
x.....||...........||.....x
x.9xx....xx9...9xx....xx9.x
x.xxxx..xxxx...xxxx..xxxx.x
x.xxxx..xxxx...xxxx..xxxx.x
x..xx9..9xx.....xx9..9xx..x
x.....xx...........xx.....x
x..xx9xx9xx.....xx9xx9xx..x
x..xx....xx.....xx....xx..x
x..9..**..9.....9..**..9..x
x.xx.*OO*.xx...xx.*OO*.xx.x
x.xx.*OO*.xx...xx.*OO*.xx.x
x..9..**..9.....9..**..9..x
x..xx....xx.....xx....xx..x
x..xx9xx9xx.....xx9xx9xx..x
x.....xx...........xx.....x
 .........................
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 14 |, 6 *, 20 monsters
NAME:   vaults_end_minmay_odd_checkers
TAGS:   vaults_end_quadrant_prize unrand
SUBST:  9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 .999x......xx......xx...
x....x......xx......xx....x
x....9..xx...9..xx....9...x
x....9..xx...9..xx.....9..x
x....x......xx..........xxx
x....x......xx..9.......xxx
x.99.x..xx.......9..xx....x
x....x*.xx..........xx....x
x....x*...9.....xx..9...xxx
x....x|....9....xx..9...xxx
x...9x|.....xx......xx....x
x..9.x|99...xx......xx....x
x.9..x|9xx......xx......xxx
x9...x||xx9.....xx......xxx
x....x|*|99.....9........9x
x....xO||||||**.9........9x
xxxx.xxxxxxxxxxxxxxxxx..xxx
x..........9.............9x
x....x....9..........9...9x
x....x...9...........9...9x
 ....x..9.................
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 8 |, 19 *, 18 monsters
NAME:   vaults_end_minmay_bends
TAGS:   vaults_end_quadrant_prize unrand
SUBST:  9 = 8 9 .:20
NSUBST: O = 1:O / *:|
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 ....x9***9x9....x9.......
x....x.9.9.x.9...x.9......x
x....x..x..x..x..x..xxxx..x
x....x..x..x..x..x...**x..x
x9xxxx..x..x..x..x...**x..x
x...9x..x..x..x..x..x..x..x
x..9.x..x..x..x...9.....9.x
x.9..x..x..x..x....9.....9x
x....x..x..x..xxxx..xxxxxxx
x....x..x..x9..|Ox........x
x....x..x..x.9..|x.......*x
x....x..x..x..x..xxxxxxx.*x
x....x..x|.....9........9*x
x....x..xO|.....9........9x
x....x..xxxx..xxxxxxxxxxxxx
x....x*...9x9............9x
x....x**.9.x.9..........9.x
x....xxxx..xxxxxxxxxxxxx..x
x.9.9......x.**|Ox.....x..x
x..9.......x..**|x.....x..x
 .9........9...**x.....9..
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 7 |, 18 *, 20 monsters
NAME:   vaults_end_minmay_plus_grid_2
TAGS:   vaults_end_quadrant_prize unrand
SUBST:  9 = 8 9 .:20
NSUBST: O = 1:O / *:|
SUBST:  X : x., Y : x.
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
 .xxxxxxxxxxxxxxxxxxxxxxx
.....x.9.x.9.x.9.x.9.x.9.
x.x.x.x.x.x.x*x.x.x.x.x.x.x
x..x.9.x.9.x*O*x.9.x.9.x.9x
x.x.x.x.x.xYx*xYx.x.x.x.x.x
xx.9.x.9.xYYYxYYYx.9.x.9.xx
x.x.x.x|xXxYxYxYxXx*x.x.x.x
x9.x.9|xXXXxYYYxXXXx.9.x.9x
x.x.x.xYxXxXxYxXxXxYx.x.x.x
xx.9.xYYYxXXXxXXXxYYYx.9.xx
x*x*xXxYxYxXxXxXxYxYxXx*x*x
x9OxXXXxYYYxXXXxYYYxXXXxO9x
x*x*xXxYxYxXxXxXxYxYxXx*x*x
xx.9.xYYYxXXXxXXXxYYYx.9.xx
x.x.x.xYxXxXxYxXxXxYx.x.x.x
x9.x.9.xXXXxYYYxXXXx|9.x.9x
x.x.x.x*xXxYxYxYxXx|x.x.x.x
xx.9.x.9.xYYYxYYYx.9.x.9.xx
x.x.x.x.x.xYx*xYx.x.x.x.x.x
x..x.9.x.9.x*O*x.9.x.9.x..x
x.x.x.x.x.x.x*x.x.x.x.x.x.x
 ....x.9.x.9.x.9.x.9.x....
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 16 *, 8 |, 16 monsters
NAME:   vaults_end_minmay_odd_hourglass
TAGS:   vaults_end_quadrant_prize unrand
SUBST:  9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 ....9x.................x
x....x.x...............x9xx
x....xx9x.............x.xxx
x...x.xx.x...........x9xx.x
x...9..xx9x.........x.xx..x
x...x...xx.x.......x9xx...x
x........xx9x.....x.xx..x9x
x...x.....xx.x...x9xx..xx9x
x...9......xxxxxxxxx..xx*.x
x...x......9.9..9.9..xx**.x
x...................xx|**.x
x...x......9.9..9.9xx||**.x
x...9......xxxxxxxxxO||**.x
x...x.....xx9x...x.xx||**.x
x........xx.x.....x9xx|**.x
x...x...xx9x.......x.xx**.x
x...9..xx.x.........x9xx*9x
x...x.xx9x...........x.xx9x
x....xx.x.............x9xxx
x....x9x...............x.xx
 .....x.................x9
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 16 *, 10 |, 16 monsters
NAME:    vaults_end_nooodl_tilted_maze
TAGS:    vaults_end_quadrant_prize unrand
SUBST:   9 = 8 9 .:10
NSUBST:  O = 1:O / *:|
SUBST:   * = * $:4
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 ........9...xx..xx.......
x........xx..xx...9....9..x
x....xx..xx...x.......xxxxx
xxx..xx.......x.9.xx..xx..x
xxx.......9...xx..xx......x
x.9.......xxxxxx...x.9....x
x.....xx|.xx.9.....x...xx.x
x.xx..xx|..........xxxxxx.x
xxxx..*x|9..$$$xx*.xx.9...x
x....9*xO||xxxxxx*........x
x..$***xxxxxx||Ox*......xxx
x..xxxxxx$$$..9|x***xx..xxx
x9.xx$$..9.....|xxxxxx...9x
x...9.......xx.*xx***$....x
x.......xxxxxx..*x*9.....xx
x...xx..xx...9..*x*..xx..xx
xx..xx..9x...$***xx..xx...x
x........x...xxxxxx.......x
x........xx..xx$$9........x
x....xx..xx...........xx..x
 ....xx9..x9......xx..xx..
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

# 21 |, 20 monsters
NAME:    vaults_end_grunt_nonplussed
TAGS:    vaults_end_quadrant_prize unrand
NSUBST:  9 = 10:8 / 10:9 / *:.
NSUBST:  O = 1:O / *:|
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 ..xxx|xxx|xxx|xxx|xxx|x.
x.9.x.9.x.9.x.9.x.9.x.9.x.x
xx.x.x.x.x.x.x.x.x.x.x.x.xx
xxx.9.x.9.x.9.x.9.x.9.x.9|x
xx.x.x.x.x.x.x.x.x.x.x.x.xx
x|9.x.9.x.9.x.9.x.9.x.9.xxx
xx.x.x.x.x.x.x.x.x.x.x.x.xx
xxx.9.x.9.x.9.x.9.x.9.x.9|x
xx.x.x.x.x.x.x.x.x.x.x.x.xx
x|9.x.9.x.9.x.9.x.9.x.9.xxx
xx.x.x.x.x.xOx.x.x.x.x.x.xx
xxx|9.x.9.x.9Ox.9.x.9.x.9|x
xx.x.x.x.x.x.xOx.x.x.x.x.xx
x|9.x.9.x.9.x.9.x.9.x.9.xxx
xx.x.x.x.x.x.x.x.x.x.x.x.xx
xxx.9.x.9.x.9.x.9.x.9.x.9|x
xx.x.x.x.x.x.x.x.x.x.x.x.xx
x|9.x.9.x.9.x.9.x.9.x.9.xxx
xx.x.x.x.x.x.x.x.x.x.x.x.xx
x.x.9.x.9.x.9.x.9.x.9.x.9.x
 ..x|xxx|xxx|xxx|xxx|xxx..
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 18 *, 8 | (11 total), 20 monsters, 8 $
NAME:   johnstein_vaults_end_asymmetric
TAGS:   vaults_end_quadrant_prize unrand
SUBST:  9 = 8 9 *:10
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxx
 ........................
x.xxxxx.9.xxxxxxxxx.9.xxx.x
x.xxxxxx...xxxxxxx...xxxx.x
x..xxxxxx...xxxxx...xxxx..x
x.9.xxxxxx...xxx...xxxx.9.x
x.x..xxxxxx...xx..xxxx..x.x
x.xx..xxxxxx*9999*xxx..xx.x
x.xxx..xxxxxx$99$xxx..xxx.x
x.xxx..xxxxxxx||xxxx..xxx.x
x.xxx..xxxxxx9*9xxxxx..xx.x
x......9*9$|9O99|$9*9.....x
x.xxx..xxxxx9*9xxxxxx..xx.x
x.xxx..xxx||||xxxxxx..xxx.x
x.xx..xxx$99$xxxxxx..xxx9.x
x.x..xx*999*xxxxxx..xxx...x
x.9.xxx...xxxxxxx..xxx..x.x
x..xxx...xxxxxxx..xxx..xx.x
x.xxxx...xxxxxx..xxx..xxx.x
x.xxxx...xxxxx..xxx..xxxx.x
x.xxxx.9.xxxx.9.xx..xxxxx.x
 .........................
  xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# Vaults:$ - Rooms Quadrant
#
# This quadrant uses a subvault for each room. Any subvault tagged
# vaults_end_room_rune should be guaranteed to provide a rune. Any subvault
# tagged vaults_end_room should just provide loot. Note that the rooms
# are not all the same sizes.
#
# about 24 |
NAME:     vaults_end_classical_rooms
TAGS:     vaults_end_quadrant_prize unrand
SHUFFLE:  AC/BD, EG/FH, IKN/MJL
SUBST:    A=., B=xx+, C=+, D=x, E=+, F=xx+, G=., H=x
SUBST:    I=., M=xx+, J=x, K=+, N=+, L=xx+
SUBST:    a:x.
SHUFFLE:  VXYZ
SUBVAULT: V : vaults_end_room_rune
SUBVAULT: X : vaults_end_room
SUBVAULT: Y : vaults_end_room
SUBVAULT: Z : vaults_end_room
SUBST:    VXYZ = .
MAP
  axxxxxxxxxxxxxxxxxxxxxa
 ............99...........
a.xxxxxxxxxxx..xxxxxxxxJxIa
x.xVVVVVVVVVx..xXXXXXXXXx.x
x.xVVVVVVVVVx..xXXXXXXXXx.x
x.xVVVVVVVVVx..xXXXXXXXXx.x
x.xVVVVVVVVVx..xXXXXXXXXx.x
x.xVVVVVVVVVx..xXXXXXXXXx.x
x.xVVVVVVVVVx..xXXXXXXXXx.x
x.NVVVVVVVVVL..KXXXXXXXXx.x
xMxxxxxxxxxxxxxxxxxxxxxxx.x
x.9.........G998........A.x
x.9.........G998........x.x
x.xxxxxxxxxFx88xxxxxxxxDx.x
x.xYYYYYYYYYx..xZZZZZZZZx.x
x.xYYYYYYYYYx..xZZZZZZZZx.x
x.xYYYYYYYYYx..xZZZZZZZZx.x
x.xYYYYYYYYYx..xZZZZZZZZx.x
x.xYYYYYYYYYx..xZZZZZZZZx.x
x.xYYYYYYYYYx..CZZZZZZZZx.x
a.xxxxxxxxxEx..xxxxxxxxxx.a
 ...........H..B.........
  axxxxxxxxxxxxxxxxxxxxxa
ENDMAP

# Vaults:$ - Rooms Quadrant - Traps and Loot Subvault
#            Replace each square with traps or loot, but mostly floor.
NAME: vaults_end_room_traps_and_loot
TAGS: vaults_end_room
: default_subvault_glyphs()
SUBST: . = ?
: vaults_end_loot(_G)
MAP
ENDMAP

# Vaults:$ - Rooms Quadrant - Border Subvault
#            Fill the room with loot, but leave an empty border.
NAME: vaults_end_room_border
TAGS: vaults_end_room
{{
    default_subvault_glyphs()
    local w, h = subvault_size()

    local i
    for i in iter.subvault_iterator(_G) do
      if i.x == 0 or i.x == w-1 or i.y == 0 or i.y == h-1 then
        -- border
        mapgrd[i.x][i.y] = '.'
      else
        -- inside
        mapgrd[i.x][i.y] = '*'
      end
    end
}}
: vaults_end_loot(_G)
MAP
ENDMAP

# Vaults:$ - Rooms Quadrant - Diamond Subvault
#            Fill the room with money in a diamond pattern.
NAME: vaults_end_room_diamond
TAGS: vaults_end_room
{{
    default_subvault_glyphs()
    local w, h = subvault_size()

    local i
    for i in iter.subvault_iterator(_G) do
      if (i.x + i.y) % 2 == 0 then
        mapgrd[i.x][i.y] = '$'
      else
        mapgrd[i.x][i.y] = '.'
      end
    end
}}
: vaults_end_loot(_G)
MAP
ENDMAP

# Vaults:$ - Rooms Quadrant - Rune Subvault
#            Potentially contains the rune.
NAME: vaults_end_room_rune
TAGS: vaults_end_room_rune
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
......
......
..||..
..O|..
..||..
......
......
ENDMAP
